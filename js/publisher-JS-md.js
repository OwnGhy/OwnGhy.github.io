(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[10],{

/***/ 49:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony default export */ __webpack_exports__["default"] = ("<!--title: JSæ­£åˆ™å®è·µè®°å½•-->\n<!--date: 2018.12.11-->\n<!--cate: 1-->\næ­£åˆ™ä¸€ç›´æ˜¯æˆ‘çš„å¼±é¡¹ï¼ŒåŸºæœ¬çš„çŸ¥è¯†çœ‹äº†å¥½å‡ éï¼Œä½†æ˜¯å½“éœ€æ±‚æ¥äº†çš„æ—¶å€™ï¼Œå¾€å¾€è¿˜æ˜¯ä¸èƒ½æ­£ç¡®çš„ä½¿ç”¨æ­£åˆ™å»å¤„ç†é—®é¢˜ï¼Œå¸¸å¸¸éƒ½æ˜¯åœ¨ç½‘ä¸Šæœç´¢çš„ç­”æ¡ˆğŸ˜¢ã€‚\n\nä¸ºäº†æŒæ¡æ­£åˆ™ï¼Œåœ¨è¿™é‡Œè®°å½•è‡ªå·±å¹³æ—¶é‡åˆ°çš„ä¸€äº›æ­£åˆ™éœ€æ±‚ï¼Œä»¥åŠä½¿ç”¨æ–¹æ³•ï¼Œé€šè¿‡è¶Šæ¥è¶Šå¤šçš„ä½¿ç”¨ï¼Œå¸Œæœ›èƒ½çœŸçš„æŒæ¡æ­£åˆ™ã€‚\n\nå¦ï¼šç”±äºæˆ‘åŸºç¡€çœŸçš„ä¸å¥½ï¼Œæ‰€ä»¥éƒ½å†™å¾—å¾ˆåŸºç¡€ğŸ˜¢ï¼Œç›®çš„åœ¨äºèƒ½å·©å›ºä¸€ä¸‹ã€‚`å•°å—¦é¢„è­¦~`\n\n> å…³äºæ­£åˆ™çš„æ¦‚å¿µä¸åŸºç¡€çš„å­¦ä¹ ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« [JSæ­£åˆ™è¡¨è¾¾å¼å®Œæ•´æ•™ç¨‹ï¼ˆç•¥é•¿ï¼‰](https://juejin.im/post/5965943ff265da6c30653879#heading-0)ï¼Œå†™å¾—æ¯”è¾ƒç³»ç»Ÿå®Œæ•´ï¼Œéå¸¸æ£’å‘€ï¼Œç»ˆäºç³»ç»Ÿçš„å­¦ä¹ æ­£åˆ™äº†ã€‚\n\n<!-- more -->\n## å®é™…éœ€æ±‚ç±»\n\n### è·å–URLçš„æŸ¥è¯¢å‚æ•°\nä¹‹å‰è·å–urlçš„æŸ¥è¯¢å‚æ•°éƒ½æ˜¯ç”¨çš„ç¬¬ä¸‰æ–¹çš„å·¥å…·ï¼Œå…¶å®è¦è‡ªå·±åŒ¹é…è·å–è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚\n\n```\n// ?name=nancy&id=123\nlet query = {};\nlocation.search.replace(/([^?&=]+)=([^&]+)/g, ($0, $1, $2) => query[$1] = $2);\nconsole.log(query);  // { name: 'nancy', id: '123' }\n```\nè§£æï¼Œä¸»è¦æ˜¯ä¸¤ä¸ªåˆ†ç»„å’Œä¸€ä¸ª`=`ï¼š\n\n- `([^?&=]+)`ï¼šè¿™ä¸ªåˆ†ç»„ç”¨äºåŒ¹é…æŸ¥è¯¢å‚æ•°çš„keyï¼Œ`[^?&=]`è¿™ä¸ªåå‘å­—ç¬¦é›†ä¸­è¡¨ç¤ºï¼Œkeyä¸èƒ½åŒ…æ‹¬`?`ã€`&`æˆ–è€…`=`ï¼Œè¾¾åˆ°å»é™¤è¿™ä¸‰ä¸ªç¬¦å·çš„ç›®çš„\n- `=`ï¼šç”¨`=`é—´éš”keyå’Œvalue\n- `([^&]+)`ï¼šè¿™ä¸€ä¸ªåˆ†ç»„å’Œå‰ä¸€ä¸ªåˆ†ç»„å·®ä¸å¤šï¼Œåªä¸è¿‡ä¸åŒ…æ‹¬`?`å› ä¸ºåé¢çš„valueä¸ä¼šå‡ºç°`?`ï¼Œåªåœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦å‡ºç°\n\né€šè¿‡replaceçš„æ–¹æ³•ï¼Œå°†åŒ¹é…çš„åˆ°keyå’Œvalueèµ‹å€¼åˆ°ç»“æœqueryä¸­ï¼Œç›®çš„è¾¾åˆ°å•¦âœŒï¸ã€‚\n\n### åŒ¹é…16è¿›åˆ¶é¢œè‰²å€¼\n```\nconst reg = /#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})/g;\n\nconst colors = '#ad4 #eee #ffffff #123fff';\n\nconsole.log(colors.match(reg));\n// [\"#ad4\", \"#eee\", \"#ffffff\", \"#123fff\"]\n```\nè§£æï¼š\n\n- `#`ï¼š16è¿›åˆ¶é¢œè‰²ä»¥`#`å¼€å¤´\n- `[0-9a-fA-F]`ï¼šåŒ¹é…16è¿›åˆ¶å­—ç¬¦\n- `{6}`å’Œ`{3}`ï¼š 16è¿›åˆ¶é¢œè‰²å¯ä»¥æ˜¯6ä½çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯3ä½çš„ç¼©å†™ï¼Œ `|`è¡¨ç¤ºå¯é€‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`{6}`åœ¨`{3}`å‰é¢ï¼Œæ˜¯ä¸ºäº†é¿å…åŒ¹é…6ä½æ—¶æå‰ç»“æŸåŒ¹é…\n\n### åŒ¹é…å…ƒç´ çš„id\néœ€æ±‚ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²ä¸­åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼Œè¦æ±‚åŒ¹é…è¯¥å­—ç¬¦ä¸²ä¸­å…ƒç´ çš„idã€‚\n\n```\nconst element = '<div id=\"test\"></div>';\nconst reg = /id=\".*\"/\nconsole.log(element.match(reg));\n// id=\"test\"\n```\nä¸Šé¢çš„æ­£åˆ™å¾ˆç®€å•ï¼Œå°±æ˜¯åŒ¹é…`id=\"`åå¸¦æœ‰ä»»æ„å­—ç¬¦ä»»æ„æ¬¡æ•°ï¼Œä¸”ä»¥`\"`ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚\n\nä½†æ˜¯â—ï¸ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé‡è¯`*`æ˜¯**è´ªå©ª**çš„ï¼Œä¸Šé¢çš„å…ƒç´ idåŒ¹é…æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“å…ƒç´ å­—ç¬¦ä¸²ä¸º`<div id=\"test\" class=\"content\"></div>`çš„æ—¶å€™ï¼Œä¸Šé¢çš„æ­£åˆ™åŒ¹é…ç»“æœæ˜¯`id=\"test\" class=\"content\"`ï¼Œå› ä¸º`*`çš„è´ªå©ªæ¨¡å¼ï¼Œä¸”é€šé…ç¬¦`.`ä¸­ä¹ŸåŒ…æ‹¬äº†`\"`ï¼Œæ‰€ä»¥æ­£åˆ™ä¼šåœ¨åŒ¹é…æœ€åä¸€ä¸ª`\"`çš„æ—¶å€™æ‰ç»“æŸåŒ¹é…ã€‚\n\nè§£å†³æ–¹æ³•ï¼š\n\n```\nconst element = '<div id=\"test\" class=\"content\"></div>';\nconst reg = /id=\".*?\"/\nconsole.log(element.match(reg));  // id=\"test\"\n```\nè§£æï¼Œæ ¸å¿ƒæ˜¯æƒ°æ€§åŒ¹é…ï¼š\n\n- `*?`ï¼šåœ¨`*`åé¢æ·»åŠ `?`å³æƒ°æ€§æ¨¡å¼ï¼Œè¡¨ç¤ºå°½å¯èƒ½å°‘çš„å»åŒ¹é…ï¼Œå½“åŒ¹é…åˆ°ç¬¬ä¸€ä¸ª`\"`æ—¶ï¼Œå°†å…¶å½’çº³ä¸ºå°¾éƒ¨çš„`\"`\n\nä½†æ˜¯ä¸Šé¢çš„åšæ³•æ•ˆç‡æ¯”è¾ƒä½ï¼Œä¼šæ¶‰åŠåˆ°â€œå›æº¯â€è¿™ä¸ªæ¦‚å¿µã€‚æ‰€ä»¥å¯ä»¥ä¼˜åŒ–ï¼š\n\n```\nconst element = '<div id=\"test\" class=\"content\"></div>';\nconst reg = /id=\"[^\"]\"/\nconsole.log(element.match(reg));\n// id=\"test\"\n```\nè§£æï¼š\n\n- `[^\"]`ï¼šä½¿ç”¨åå‘å­—ç¬¦é›†å»æ’é™¤`\"`å³å¯\n\n> å›æº¯ï¼Œä¹Ÿç§°è¯•æ¢æ³•ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šä»é—®é¢˜çš„æŸä¸€ç§çŠ¶æ€ï¼ˆåˆå§‹çŠ¶æ€ï¼‰å‡ºå‘ï¼Œæœç´¢ä»è¿™ç§çŠ¶æ€å‡ºå‘æ‰€èƒ½è¾¾åˆ°çš„æ‰€æœ‰â€œçŠ¶æ€â€ï¼Œå½“ä¸€æ¡è·¯èµ°åˆ°â€œå°½å¤´â€çš„æ—¶å€™ï¼ˆä¸èƒ½å†å‰è¿›ï¼‰ï¼Œå†åé€€ä¸€æ­¥æˆ–è‹¥å¹²æ­¥ï¼Œä»å¦ä¸€ç§å¯èƒ½â€œçŠ¶æ€â€å‡ºå‘ï¼Œç»§ç»­æœç´¢ï¼Œç›´åˆ°æ‰€æœ‰çš„â€œè·¯å¾„â€ï¼ˆçŠ¶æ€ï¼‰éƒ½è¯•æ¢è¿‡ã€‚è¿™ç§ä¸æ–­â€œå‰è¿›â€ã€ä¸æ–­â€œå›æº¯â€å¯»æ‰¾è§£çš„æ–¹æ³•ï¼Œå°±ç§°ä½œâ€œå›æº¯æ³•â€ã€‚\n> \n> å…³äºæ›´å¤šå…³äºæ­£åˆ™å›æº¯çš„è§£é‡Šå¯ä»¥å‚è€ƒæœ€å¼€å§‹æè¿‡çš„æ–‡ç« ï¼š[JSæ­£åˆ™è¡¨è¾¾å¼å®Œæ•´æ•™ç¨‹ï¼ˆç•¥é•¿ï¼‰](https://juejin.im/post/5965943ff265da6c30653879#heading-21)\n\n### ä¸­æ‹¬å·å†…å®¹åŠä¸­æ‹¬å·åŠ ç²—\n#### åœºæ™¯\néœ€æ±‚æ˜¯å¯¹ç³»ç»Ÿç”¨æˆ·çš„æ“ä½œè¿›è¡Œè®°å½•ï¼Œåç«¯ä¼šå°†æ“ä½œæè¿°æ‹¼æ¥ä¸º`[å¼ ä¸‰]åˆ›å»ºè´¦å•[213]`è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œåœ¨å‰ç«¯æ‹¿åˆ°ä¹‹åéœ€è¦è¿›è¡Œå¤„ç†ï¼Œå°†ä¸­æ‹¬å·åŠä¸­æ‹¬å·ä¸­çš„å†…å®¹åŠ ç²—ã€‚\n\n```\ntext.replace(/\\[[^\\[\\]]*]/g,$0 => {\n\treturn `<b>${$0}</b>`;\n})\n// <b>[å¼ ä¸‰]</b>åˆ›å»ºè´¦å•<b>[213]</b>\n```\nä¸Šé¢çš„ä»£ç å¯ä»¥æ­£ç¡®çš„åŒ¹é…å¹¶å¾—åˆ°ç»“æœã€‚\n\nè§£æï¼š\n\n- `\\[`ï¼š`[`æ˜¯ç‰¹æ®Šç¬¦å·ï¼Œéœ€è¦è½¬ä¹‰\n- `[^\\[\\]]*`:`[^]`è¡¨ç¤ºåå‘å­—ç¬¦é›†ï¼Œåœ¨åå‘å­—ç¬¦é›†ä¸­æ·»åŠ `\\[\\]`è¡¨ç¤ºä¸åŒ¹é…`[`å’Œ`]`ï¼Œä»¥é¿å…åµŒå¥—ä¸­æ‹¬çš„æƒ…å†µï¼Œ`*`è¡¨ç¤ºä¸æ˜¯`[`å’Œ`]`çš„å­—ç¬¦å¯ä»¥å‡ºç°ä»»æ„æ¬¡æ•°\n- `]`ï¼šè¡¨ç¤ºç»“å°¾çš„åŒ¹é…ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯`]`ä¸æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œå¯ä»¥ä¸ç”¨è½¬ç§»ï¼Œä½†æ˜¯åœ¨ä¸Šä¸€æ­¥çš„åå‘å­—ç¬¦é›†ä¸­ï¼Œä¸ºäº†åŒºåˆ†åå‘å­—ç¬¦é›†çš„ç»“å°¾ï¼Œæ‰€ä»¥è¿›è¡Œäº†è½¬ä¹‰\n\n#### æ‹“å±•\nä¸Šé¢çš„æ­£åˆ™ï¼Œå¦‚æœä¸­æ‹¬å·å‡ºç°åµŒå¥—çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼š`[[å¼ ä¸‰]]åˆ›å»ºè´¦å•[213]`ä¼šæ›¿æ¢æˆ`[<b>[å¼ ä¸‰]</b>åˆ›å»ºè´¦å•<b>[213]</b>`ï¼Œåªä¼šåŒ¹é…æœ€å†…å±‚çš„ä¸­æ‹¬å·ï¼Œé‚£ä¹ˆå¦‚ä½•åŒ¹é…æœ€å¤–å±‚çš„ä¸­æ‹¬å·å‘¢ï¼Ÿ\n\n```\ntext.replace(/\\[[^\\]]*]*/g,$0 => {\n\treturn `<b>${$0}</b>`;\n})\n// \"<b>[[å¼ ä¸‰]]</b>åˆ›å»ºè´¦å•<b>[213]</b>\"\n```\n\nè§£æï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äºä¸‹é¢ä¸¤ç‚¹ï¼š\n- `[^\\]]`ï¼šåå‘å­—ç¬¦é›†ä¸­å»é™¤äº†`\\[`ï¼Œä»¥è¾¾åˆ°å¯ä»¥åŒ…æ‹¬`[`çš„ç›®çš„ï¼Œä½†æ˜¯ä¾æ—§åŒ…å«`\\]`æ˜¯ä¸ºäº†åœ¨é‡åˆ°ç¬¬ä¸€ä¸ª`]`çš„æ—¶å€™ç»§ç»­åŒ¹é…\n- `]*`ï¼š å°¾éƒ¨çš„ç»“æŸå¯ä»¥å¤šä¸ª`]`ï¼Œè¿™æ ·é¿å…äº†åœ¨é‡åˆ°å¤šä¸ª`]`çš„æ—¶å€™æ­£åˆ™åŒ¹é…æå‰ç»“æŸï¼Œå¦‚æœä¸æ·»åŠ `]*`çš„æƒ…å†µï¼Œé‚£ä¹ˆæœ€åçš„åŒ¹é…ç»“æœå°†æ˜¯`<b>[[å¼ ä¸‰]</b>]åˆ›å»ºè´¦å•<b>[213]</b>`ï¼Œå¯¼è‡´é‡åˆ°ç¬¬ä¸€ä¸ªä¸­æ‹¬å·æå‰ç»“æŸï¼Œä»¥è‡´åŒ¹é…é”™è¯¯\n\n### æ•°å­—çš„åƒä½åˆ†éš”ç¬¦è¡¨ç¤º\n```\nconst reg = /(?!^)(?=(\\d{3})+$)/g;\nconst numStr = '123456789';\nconsole.log(numStr.replace(reg, ','));\n// 123,456,789\n```\nè§£æï¼š\n\n`(?=(\\d{3})+$)`ï¼š é¦–å…ˆ`(?=p)`æ˜¯ä½ç½®åŒ¹é…æ¨¡å¼ï¼Œå­æ¨¡å¼ p è¿™é‡Œæ˜¯`(\\d{3})+$`ï¼Œ`(\\d{3})+`è¡¨ç¤ºæ¯ä¸‰ä½æ•°å­—ä¸ºä¸€ç»„ï¼Œ`$`åœ¨è¿™é‡Œæœ‰ä»å°¾éƒ¨å¼€å§‹åŒ¹é…çš„å«ä¹‰ã€‚æ‰€ä»¥è¿™ä¸€ç»„çš„å«ä¹‰å°±æ˜¯åŒ¹é…æ¯ä¸‰ä½æ•°å­—å‰çš„ä½ç½®ã€‚\n`(?!^) `ï¼šè¿™ä¸€æ­£åˆ™çš„å«ä¹‰æ˜¯åŒ¹é…çš„ä½ç½®ä¸èƒ½æ˜¯å¼€å¤´ï¼Œæ˜¯ä¸ºäº†è§£å†³ 123456 åŒ¹é…æˆ ,123,456 çš„æƒ…å†µã€‚\n\n## æ•°å­—ç±»\nå¾…ç»­...\n\n## æ­£åˆ™saoæ“ä½œ\n### åŒ¹é…ä»»æ„å­—ç¬¦\næˆ‘ä»¬çŸ¥é“`.`è¡¨ç¤ºåŒ¹é…ä»»åŠ¡å­—ç¬¦ï¼Œé™¤äº†æ¢è¡Œç¬¦ã€å›è½¦ç¬¦ã€è¡Œåˆ†éš”ç¬¦å’Œæ®µåˆ†éš”ç¬¦ï¼Œç­‰åŒäº`[^\\n\\r\\u2028\\u2029]`ï¼Œè¦åŒ¹é…ä»»æ„å­—ç¬¦å¯ä»¥ç”¨ï¼š`[\\d\\D]`ã€`[\\w\\W]`ã€`[\\s\\S]`å’Œ`[^]`ï¼Œåæ­£æˆ‘è§‰å¾—æ˜¯æœ‰ç‚¹saoçš„ğŸ¤£ã€‚\n\n### ä¸åŒ¹é…ä»»ä½•å­—ç¬¦çš„æ­£åˆ™\nemm...æ­£åˆ™ä¸å°±æ˜¯è¦åŒ¹é…å˜›ï¼Œä½ è®©æˆ‘ä¸åŒ¹é…ä»»ä½•å­—ç¬¦ï¼Ÿï¼Ÿï¼Ÿæœ‰æ„æ€å˜›ğŸ˜‚ã€‚\n\nä¸è¿‡æˆ‘è¿˜çœŸåœ¨ç½‘ä¸Šçœ‹åˆ°è¿™ä¸ªæ­£åˆ™ï¼š`/.^/`ã€‚è¯¥æ­£åˆ™å°±å¯ä»¥ä¸åŒ¹é…ä»»ä½•å­—ç¬¦ã€‚è¯¥æ­£åˆ™è¦æ±‚åªæœ‰ä¸€ä¸ªä»»æ„å­—ç¬¦ä¸”ï¼Œåœ¨å¼€å¤´ä¹‹å‰ï¼Œæ‰€æœ‰å°±æ˜¯ä¸åŒ¹é…ä»»ä½•å­—ç¬¦äº†ğŸ¤£ã€‚");

/***/ }),

/***/ 50:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony default export */ __webpack_exports__["default"] = ("<!--title: ç”¨è¿‡ =Ì¸ æŒæ¡ä¹‹æ–‡ä»¶ä¸Šä¼ -->\n<!--date: 2019.10.23-->\n<!--cate: 1-->\nåœ¨å¼€å‘ä¸­ï¼Œè™½ç„¶ç»å¸¸å€ŸåŠ©ç»„ä»¶åº“ or å·¥å…·åº“å®ç°äº†å¾ˆå¤šä¸šåŠ¡åŠŸèƒ½ï¼Œä½†å¾€å¾€éƒ½æ²¡æœ‰å»æ¢ç©¶è¿‡åŸç†æˆ–è€…è‡ªå·±æ‰‹åŠ¨å®ç°è¿‡ã€‚è™½ç„¶åœ¨æ•æ·å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸è¦é‡å¤é€ è½®å­æ‰èƒ½æ»¡è¶³æ•æ·å¼€å‘çš„å¿«èŠ‚å¥çš„éœ€æ±‚ã€‚ä½†æ˜¯å­¦ä¹ å…¶ä¸­çš„åŸç†èƒ½å¯¹æˆ‘ä»¬çš„æ°´å¹³æœ‰å¾ˆå¤§çš„æå‡ã€‚\n\nä¸ºäº†è®©è‡ªå·±åšæŒä¸‹å»ï¼Œä¸è®©è‡ªå·±æˆä¸ºä¸€ä¸ª **API è°ƒç”¨å¸ˆ**ï¼Œç«‹ä¸€ä¸ª flagï¼Œæ¯å‘¨è‡³å°‘å­¦ä¹ ä¸€ä¸ª**ç”¨è¿‡ â‰  æŒæ¡**çš„çŸ¥è¯†ï¼Œä¼šé™†é™†ç»­ç»­å‡ºè¿™ä¸ªç³»åˆ—çš„ç¬”è®°ã€‚\n\nè¿›å…¥æ­£é¢˜ã€‚\n\næ­£å¥½ä»Šå¤©çœ‹åˆ°ä¸€ç¯‡æ–‡ä»¶ä¸Šä¼ å¾ˆå®Œæ•´çš„åšå®¢ï¼Œæ‰€ä»¥å¯¹è¿™æ–¹é¢åšä¸€ä¸ªçŸ¥è¯†æ•´ç†ã€‚\n<!-- more -->\n\nå‚è€ƒï¼š[å†™ç»™æ–°æ‰‹å‰ç«¯çš„å„ç§æ–‡ä»¶ä¸Šä¼ æ”»ç•¥ï¼Œä»å°å›¾ç‰‡åˆ°å¤§æ–‡ä»¶æ–­ç‚¹ç»­ä¼ ](https://juejin.im/post/5da14778f265da5bb628e590)\n\n### HTTP æ–‡ä»¶ä¸Šä¼ èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\n\n#### æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ\n\næ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ç£ç›˜ä¸Šçš„ä¸€æ®µç©ºé—´ï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯ä¸€ä¸² 2 è¿›åˆ¶æ•°å­—ï¼ˆ1 æˆ–è€… 0ï¼‰ã€‚\n\næ–‡ä»¶ä¼ è¾“ï¼Œå°±æ˜¯æŠŠè¿™ä¸²æ•°å­—åŒæ„Ÿ http åè®®ä¼ è¿‡å»ã€‚\n\næœåŠ¡å™¨ç«¯ï¼Œæ¥åˆ°è¿™æ®µæ•°æ®ä¹‹åï¼ŒæŒ‰ç…§åè®®è§„å®šçš„æ ¼å¼ï¼ŒæŠŠè¿™ä¸²æ•°å­—å–å‡ºæ¥ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼ˆåˆ†é…ä¸€æ®µç©ºé—´ï¼‰ï¼Œç„¶åæŠŠè¿™æ®µæ•°å­—å†™è¿›å»ï¼Œå°±æˆäº†ä¸€ä¸ªè·Ÿä¸Šä¼ æ–‡ä»¶å®Œå…¨ä¸€è‡´çš„æ–°æ–‡ä»¶ã€‚\n\nå‚è€ƒï¼š[httpï¼šæ–‡ä»¶ä¸Šä¼ èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ - éšæºªæ¼‚èƒ–çŒ«çš„å›ç­” - çŸ¥ä¹](httpï¼šæ–‡ä»¶ä¸Šä¼ èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ - éšæºªæ¼‚èƒ–çŒ«çš„å›ç­” - çŸ¥ä¹\nhttps://www.zhihu.com/question/58118565/answer/155688756)\n\n#### MIME æ˜¯ä»€ä¹ˆï¼Ÿ\n\n**MIME** å¹¶ä¸é™Œç”Ÿï¼Œä½†æ˜¯ä¸€ç›´éƒ½ä¸æ˜¯å¾ˆæ˜ç™½å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆã€‚åœ¨ HTTP è¯·æ±‚ä¸­ä¹Ÿä¼šç”¨åˆ° **MIME**ï¼Œæ‰€ä»¥å…ˆé¢„å¤‡ä¸€ä¸‹çŸ¥è¯†ã€‚**MIME** ä¸æ˜¯ HTTP åè®®çš„ä¸€éƒ¨åˆ†ï¼Œå…¶å…¨ç§° **MIMEï¼ˆMultipurpose Internet Mail Extensionsï¼‰**å³å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚å…¶æœ¬è´¨å°±æ˜¯ç”¨äºæ ¹æ®æ¯ä¸ªèµ„æºè‡ªèº«çš„å±æ€§æ ‡è¯†æ¯ä¸ªèµ„æºçš„ç±»å‹ï¼Œä¾‹å¦‚è§†é¢‘ã€HTML é¡µé¢ã€å›¾ç‰‡ç­‰ï¼Œéƒ½æ˜¯ä¸åŒç±»å‹çš„èµ„æºã€‚\n\nä¾‹å¦‚é€šè¿‡`http://localhost/image.png`è®¿é—®å›¾ç‰‡ï¼Œå¹¶ä¸æ˜¯æ ¹æ®.pngåç¼€å»åˆ¤æ–­èµ„æºçš„ç±»å‹ï¼Œè€Œæ˜¯é€šè¿‡è·å–è¿™ä¸ªèµ„æºçš„ **MIME** æ¥è·å–è¿™ä¸ªèµ„æºçš„ç±»å‹`image/png`ã€‚\n\n**MIME** ä½¿ç”¨çš„åœ°æ–¹å¾ˆå¤šï¼š\n\n- HTTP è¯·æ±‚å¤´ä¸­ï¼Œç”¨äºè®¾ç½® `Content-Type` å»æ ‡è¯†å½“å‰è¯·æ±‚ä½“ä¸­çš„æ•°æ®æ ¼å¼ç±»å‹\n- `<script type='text/javascript'></script>`ç­‰ç±»ä¼¼çš„æ ‡ç­¾å»æ ‡è¯†èµ„æºçš„ç±»å‹\n- ...\n\næ‰€æœ‰ **MIME** ç±»å‹å€¼ï¼š[MIME å‚è€ƒæ‰‹å†Œ](https://www.w3school.com.cn/media/media_mimeref.asp)ã€‚\n\n#### Content-Type å‡ ç§å¸¸è§çš„ç±»å‹\n\n**Content-Type** ç”¨äºè¯´æ˜è¯·æ±‚æˆ–è¿”å›çš„æ¶ˆæ¯ä¸»é¢˜æ˜¯ç”¨ä»€ä¹ˆæ–¹å¼ç¼–ç ã€‚\n\nå¸¸è§çš„ç±»å‹æœ‰ï¼š\n\n- `application/x-www-form-urlencoded`ï¼šæµè§ˆå™¨çš„åŸç”Ÿformè¡¨å•ï¼Œæäº¤çš„æ•°æ®æŒ‰ key1=val1&key2=val2 çš„æ–¹å¼è¿›è¡Œç¼–ç ï¼Œkey å’Œ val éƒ½è¿›è¡Œäº† URL è½¬ç \n- `multipart/form-data`ï¼šå¸¸è§çš„ POST æ•°æ®æäº¤æ–¹å¼ï¼Œä½¿ç”¨è¡¨å•ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œéœ€è®¾ç½® form çš„ enctype='multipart/form-data'\n- `application/json`ï¼šæ•°æ®æ—¶åºåˆ—åŒ–åçš„ JSON å­—ç¬¦ä¸²\n\næ›´å¤šçš„ç±»å‹å‚è€ƒï¼š[HTTP content-type](https://www.runoob.com/http/http-content-type.html)\n\n#### ä¸Šä¼ æ–‡ä»¶çš„ HTTP æŠ¥æ–‡åˆ†æ\n\næ™®é€š Form è¡¨å•æ•°æ®è¯·æ±‚æŠ¥æ–‡:\n\n```\nPOST /upload HTTP/1.1\nHost: localhst\nCache-Control: no-cache\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundarybygnDMezTNBFKJW8\n\n\n------WebKitFormBoundarybygnDMezTNBFKJW8\nContent-Disposition: form-data; name=\"param1\"\n\n1\n------WebKitFormBoundarybygnDMezTNBFKJW8\nContent-Disposition: form-data; name=\"param2\"\n\n2\n------WebKitFormBoundarybygnDMezTNBFKJW8--\n\n```\n\nåœ¨è¯·æ±‚å¤´ä¸­çš„ `Content-Type` ç±»å‹æ˜¯ `multipart/form-data`ï¼Œå…¶ä¸­ boundary=----xxx æ˜¯å¤šä¸ªè¡¨å•é¡¹ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œä»¥è¾¾åˆ°åˆ†å‰²æ•°æ®çš„ç›®çš„ã€‚åˆ†å‰²å¾—åˆ°çš„è¡¨å•é¡¹ä¸­ï¼Œ `Content-Disposition` åŒ…å«äº†è¡¨å•é¡¹çš„åŸºæœ¬ä¿¡æ¯ï¼Œå›ºå®šä»¥ `form-data` å¼€å¤´ï¼Œname è¡¨ç¤ºè¡¨å•å…ƒç´ å±æ€§åã€‚æ¢è¡Œä¹‹åå°±æ˜¯è¡¨å•é¡¹çš„å€¼ã€‚\n\nå«æ–‡ä»¶çš„ Form è¡¨å•æ•°æ®è¯·æ±‚æŠ¥æ–‡ï¼š\n\n```\nPOST /upload HTTP/1.1\nHost: localhst\nCache-Control: no-cache\nContent-Type: multipart/form-data; boundary=----Boundary\n\n------Boundary\nContent-Disposition: form-data; name=\"file\"; filename=\"file.png\"\nContent-Type: image/png\n\n<è¿™é‡Œæ˜¯å›¾ç‰‡äºŒè¿›åˆ¶å†…å®¹>\n------Boundary\nContent-Disposition: form-data; name=\"param1\"\n\nvalue1\n------Boundary\nContent-Disposition: form-data; name=\"param2\"\n\nvalue2\n------Boundary--\n```\n\nä¸Šé¢å°±æ˜¯ä¸€ä¸ªåŒ…å«æ–‡ä»¶ä¸Šä¼ çš„è¯·æ±‚æŠ¥æ–‡ï¼Œä¸æ™®é€šçš„è¡¨å•æ•°æ®çš„æŠ¥æ–‡ä¸åŒï¼Œæ–‡ä»¶çš„è¡¨å•é¡¹ä¸­çš„ `Content-Disposition` ä¼šå¤šä¸€ä¸ª `filename` æ ‡è¯†ä¸Šä¼ çš„æ–‡ä»¶çš„åç§°ï¼›é™¤æ­¤ä¹‹å¤–è¿˜ä¼šå¤šä¸€ä¸ª `Content-Type` æ ‡è¯†ä¸Šä¼ çš„æ–‡ä»¶çš„ç±»å‹ã€‚\n\n#### HTTP æ–‡ä»¶ä¼ è¾“åŸç†\n\nHTTP åè®®æ˜¯åŸºäº TCP çš„**æµå¼ä¼ è¾“åè®®**ï¼Œåœ¨æ–‡ä»¶ä¼ è¾“çš„æ—¶å€™ï¼Œå¯ä»¥å€ŸåŠ© TCP çš„ç‰¹ç‚¹ã€‚\n\n- åˆ†å—ä¼ è¾“ï¼šTCP æ•°æ®åŒ…çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“ä¼ è¾“å¤§é‡æ•°æ®æ—¶ï¼Œå°±å¿…é¡»åˆ†æˆå¤šä¸ªæ•°æ®åŒ…è¿›è¡Œä¼ è¾“ï¼Œæ¯ä¸ªåŒ…æ‹¥æœ‰**ç¼–å·**ï¼Œä»¥ä¾¿æ¥å—ç«¯æŒ‰ç…§é¡ºåºè¿˜åŸæ•°æ®ï¼Œä¸”å¯ä»¥åœ¨ä¸¢åŒ…æ—¶æ‰¾åˆ°ä¸¢å¤±çš„åŒ…ã€‚HTTP åè®®å¤´ä¿¡æ¯çš„ `Content-Length` è¡¨ç¤ºä¿¡æ¯ä½“çš„å¤§å°ï¼Œç”¨äºæ¥å—ç«¯ç¡®å®šä¼ è¾“çš„ç»“æŸ\n- æ–­ç‚¹ç»­ä¼ ï¼šå½“å‡ºç°ä¸¢åŒ…æ—¶ï¼Œä¼šè¿›è¡Œé‡ä¼ ï¼Œè¿™ä¹Ÿæ˜¯ TCP å¯é ä¼ è¾“çš„ç‰¹ç‚¹ã€‚å½“å®¢æˆ·ç«¯è¶…è¿‡åˆç†çš„å¾€è¿”æ—¶å»¶ï¼ˆ**RTT**ï¼‰è¿˜æœªæ”¶åˆ°ç¡®è®¤ç ï¼Œå°±ä¼šè¢«è®¤ä¸ºæ˜¯å‡ºç°äº†ä¸¢åŒ…çš„æƒ…å†µ\n- å¤šçº¿ç¨‹ä¼ è¾“ï¼šæ¯ä¸ªæ•°æ®åŒ…çš„ä¼ è¾“ï¼Œäº’ç›¸ä¹‹é—´ä¸ä¼šé˜»å¡ï¼Œæ˜¯å¹¶è¡Œçš„\n\n### åŸºç¡€ä¸Šä¼ æ¥å£\n\n#### Nodejs åŸç”Ÿ\n\n```js\nconst http = require('http');\nconst fs = require('fs');\nconst querystring = require('querystring');\n\n// ç”¨ http æ¨¡å—åˆ›å»ºä¸€ä¸ª http æœåŠ¡å™¨\nhttp.createServer((req, res) => {\n\t\t// åˆ¤æ–­è¯·æ±‚ url\n    if (req.url === '/upload') {\n    \t\t// åˆ¤æ–­ method\n        if (req.method.toLowerCase() === 'get') {\n            // æ˜¾ç¤ºä¸€ä¸ªç”¨äºä¸Šä¼ æ–‡ä»¶çš„form\n            res.writeHead(200, {'content-type': 'text/html'});\n\n            res.end(\n                `<form action=\"/upload\" enctype=\"multipart/form-data\" method=\"post\">\n                <input type=\"file\" name=\"upload\" multiple=\"multiple\" />\n                <input type=\"submit\" value=\"Upload\" />\n            </form>`\n            )\n        } else {\n            //è¿™é‡ŒæŒ‡å®šç¼–ç ï¼Œå¤„ç†ä¹±ç çš„é—®é¢˜\n            res.writeHead(200, {'Content-Type': 'text/plain;charset=utf-8'});\n\n            if (req.headers['content-type'].indexOf('multipart/form-data') !== -1) {\n            \t\t// è§£ææ–‡ä»¶\n                parseFile(req, res);\n            } else if (req.method.toLowerCase() === 'post') {\n                res.end('å…¶ä»–æäº¤æ–¹å¼');\n            }\n        }\n    } else {\n    \t\tres.end('404');\n    }\n}).listen(3000);\n\nconsole.log('listening on 3000....');\n\nfunction parseFile(req, res) {\n\t\t// äºŒè¿›åˆ¶\n    req.setEncoding('binary');\n    let body = ''; // æ–‡ä»¶æ•°æ®\n    let fileName; // æ–‡ä»¶å\n    let contentType; // æ–‡ä»¶ç±»å‹\n\n    // è¾¹ç•Œå­—ç¬¦ä¸²\n    var boundary = req.headers['content-type'].split(';')[1].replace('boundary=', '');\n\n\t\t// http æ–‡ä»¶æ˜¯åˆ†å—ä¼ è¾“çš„ï¼Œéœ€è¦ä¾æ¬¡æ¥æ”¶ä¼ è¾“æ•°æ®\n    req.on('data', function (chunk) {\n        body += chunk;\n    });\n\n    req.on('end', function () {\n        try {\n            const file = querystring.parse(body, '\\r\\n', ':');\n            // åªå¤„ç†å›¾ç‰‡\n            if (file['Content-Type'].indexOf('image') !== -1) {\n                // è·å–æ–‡ä»¶å\n                fileName = file['Content-Disposition'].match(/filename=\"(.*)\"/)[1];\n                // è·å–å›¾ç‰‡ç±»å‹\n                contentType = file['Content-Type'].substring(1);\n                // è·å–æ–‡ä»¶äºŒè¿›åˆ¶æ•°æ®å¼€å§‹ä½ç½®ï¼Œå³ contentType çš„ç»“å°¾\n                const upperBoundary = body.toString().indexOf(contentType) + contentType.length;\n                const shorterData = body.toString().substring(upperBoundary);\n                // æ›¿æ¢å¼€å§‹ç»“æŸä½ç½®çš„ç©ºæ ¼\n                const binaryData = shorterData.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\n                // ä¿å­˜æ–‡ä»¶\n                fs.writeFile(fileName, binaryData, 'binary', function (err) {\n                    res.end('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ');\n                })\n            } else {\n                res.end('åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶');\n            }\n        } catch (err) {\n            console.log(err);\n            res.end('å‡ºé”™' + err);\n        }\n    });\n}\n```\n\n#### Koa\n\n- [koa-static](https://github.com/dlau/koa-body)ï¼šé™æ€èµ„æºç®¡ç†ä¸­é—´ä»¶ï¼Œä½¿ç”¨äº†ä¹‹åå¯ä»¥ç›´æ¥è®¿é—®æœåŠ¡çš„é™æ€èµ„æº\n- [koa-body](https://github.com/dlau/koa-body)ï¼škoaä¸»ä½“è§£æä¸­é—´ä»¶ï¼Œæ”¯æŒ multipartã€urlencoded å’Œ jsonçš„è¯·æ±‚ä½“ã€‚ä¸ express çš„ä¸»ä½“è§£æä¸­é—´ä»¶ multer ç±»ä¼¼\n\nHTML ä»£ç å¦‚ä¸‹ï¼Œæ³¨æ„ï¼Œä¸Šä¼ æ–‡ä»¶å¿…é¡»è®¾ç½® `enctype=\"multipart/form-data\"`ï¼š\n\n```html\n<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Document</title>\n</head>\n<body>\n<form method=\"post\" action=\"http://localhost:8100\" enctype=\"multipart/form-data\">\n    <input type=\"file\" name=\"file1\"/>\n    <button type=\"submit\">ä¸Š ä¼ </button>\n</form>\n</body>\n</html>\n```\n\nnodejs ä»£ç ï¼Œé…ç½® koa-body å°±å¯ä»¥å®ç°ä¸Šä¼ æ–‡ä»¶çš„æ¥å£ï¼š\n\n```js\nconst http = require('http');\nconst path = require('path');\nconst fs = require('fs');\nconst koaStatic = require('koa-static');\nconst koaBody = require('koa-body');\nconst Koa = require('koa2');\n\nconst app = new Koa();\nconst port = process.env.PORT || '8100';\nconst host = `http://localhost:${port}`;\n\napp.use(koaBody({\n    // å¼€å¯æ–‡ä»¶ä¸Šä¼ ï¼Œé»˜è®¤æ˜¯å…³é—­\n    multipart: true,\n    formidable: {\n        // è®¾ç½®æ–‡ä»¶çš„ä¿å­˜ç›®å½•ï¼Œä¸è®¾ç½®åˆ™ä¿å­˜åœ¨ç³»ç»Ÿä¸´æ—¶ç›®å½•ä¸‹\n        uploadDir: path.resolve(__dirname, './static'),\n        // ä¿æŒæºæ–‡ä»¶çš„æ‰©å±•\n        keepExtensions: true,\n    },\n}));\n\n//å¼€å¯é™æ€æ–‡ä»¶è®¿é—®\napp.use(koaStatic(\n    path.resolve(__dirname, './static')\n));\n\nconst server = http.createServer(app.callback());\nserver.listen(port);\nconsole.log('server start');\n```\n\nå­˜åœ¨çš„é—®é¢˜ï¼š\n\n- ä¸Šä¼ åçš„æ–‡ä»¶æ˜¯éšæœºå‘½åçš„\n- ä¸Šä¼ å®Œæˆåä¸ä¼šç»™å‰ç«¯è¿”å›ç»“æœ\n\nè¦è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼ŒåŠ ä¸Šä¸‹é¢çš„ä»£ç å³å¯ï¼š\n\n```\n//æ–‡ä»¶äºŒæ¬¡å¤„ç†ï¼Œä¿®æ”¹åç§°\napp.use((ctx) => {\n    const file = ctx.request.files.file1;\n    const fpath = file.path;\n    const fname = file.name;\n\n    fs.renameSync(fpath, `${path.resolve(__dirname, './static')}/${fname}`);\n    //ä»¥ json å½¢å¼è¾“å‡ºä¸Šä¼ æ–‡ä»¶åœ°å€\n    ctx.body = `{\n        \"fileUrl\":\"${host}/static/${fname}\"\n    }`;\n});\n```\n\n### Koa å¤šæ–‡ä»¶ä¸Šä¼ \n\nåŸç”Ÿçš„ nodejs å¦‚ä½•å®ç°å¤šæ–‡ä»¶ä¸Šä¼ ï¼Œæˆ‘ç›®å‰è¿˜æ²¡æœ‰æˆåŠŸï¼Œå› ä¸ºå¤šä¸ªæ–‡ä»¶åœ¨ä¸€ä¸ªboundaryçš„åˆ†å‰²ä¹‹å†…ï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•è§£æï¼Œä¹‹åæ‰¾åˆ°è§£å†³æ–¹æ³•ï¼Œä¼šåœ¨è¿™é‡Œæ›´æ–°ã€‚\n\nHTML5 ä¸­ï¼Œé€šè¿‡è®¾ç½® input æ ‡ç­¾ multiple å±æ€§ï¼Œå¯ä»¥è¾¾åˆ°åŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶çš„ç›®çš„ã€‚\n\n```html\n<input type=\"file\" name=\"file1\" multiple/> \n```\n\nåœ¨ä¹‹å‰çš„ koa ä»£ç ä¸­ï¼Œå¦‚æœåªä½¿ç”¨ koa-body çš„åŸºæœ¬é…ç½®ï¼Œå°±å¯ä»¥å®ç°å¤šæ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯å¦‚æœè¦è§£å†³æ¯ä¸ªæ–‡ä»¶ä¿æŒåŸæ–‡ä»¶çš„åå­—çš„è¯ï¼Œåœ¨æ–‡ä»¶äºŒæ¬¡å¤„ç†çš„åœ°æ–¹ä¿®æ”¹æˆä»¥ä¸‹ä»£ç ï¼š\n\n```js\n//æ–‡ä»¶äºŒæ¬¡å¤„ç†ï¼Œä¿®æ”¹åç§°\napp.use((ctx) => {\n    console.log(ctx.request.files);\n    const files = ctx.request.files.file1;\n\n    const urls = files.map(file => {\n        const fpath = file.path;\n        const fname = file.name;\n\n        fs.renameSync(fpath, `${path.resolve(__dirname, './static')}/${fname}`);\n        return `${host}/static/${fname}`;\n    });\n\n    //ä»¥ json å½¢å¼è¾“å‡ºä¸Šä¼ æ–‡ä»¶åœ°å€\n    ctx.body = `{\n        \"fileUrl\":\"${urls}\"\n    }`;\n});\n```\n\nåœ¨ä¸Šä¼ å¤šæ–‡ä»¶çš„æ—¶å€™ï¼Œfile1 æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€šè¿‡éå†ä¾æ¬¡ä¿®æ”¹æ–‡ä»¶åç§°ï¼Œæœ€åè¿”å›æ‰€æœ‰çš„æ–‡ä»¶çš„urlã€‚\n\n### æ— åˆ·æ–°ä¸Šä¼ \n\n#### xhr ç»“åˆ FormData ä¸Šä¼ \n\nå‰é¢ç›´æ¥ä½¿ç”¨çš„æ˜¯ form è¡¨å•ä¸Šä¼ ï¼Œä¸Šä¼ æˆåŠŸä¹‹åï¼Œé¡µé¢ä¼šè¿›è¡Œåˆ·æ–°ï¼Œæ˜¯å¾ˆä¸å¥½çš„äº¤äº’ã€‚\n\næ‰€ä»¥è¿™é‡Œä½¿ç”¨ xhr ç»“åˆ FormData å®ç°ä¸Šä¼ ï¼Œåœ¨ js ä¸­æ‹¿åˆ° input çš„ files å€¼ï¼Œå»æ¨¡æ‹Ÿ FormDataï¼Œç„¶åä½¿ç”¨ xhr å‘é€è¯·æ±‚å®ç°ä¸Šä¼ ã€‚\n\n```html\n<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Document</title>\n</head>\n<body>\n<input type=\"file\" id=\"file1\" multiple />\n<button type=\"submit\" id=\"submit\">ä¸Š ä¼ </button>\n<script>\n    document.getElementById('submit').addEventListener('click', function () {\n        // è·å–æ–‡ä»¶åˆ—è¡¨ï¼Œæ³¨æ„è¿™é‡Œä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯å¯¹è±¡\n        const fileList = document.getElementById('file1').files;\n        if (!fileList.length) {\n            alert('è¯·é€‰æ‹©æ–‡ä»¶');\n            return;\n        }\n        let formData = new FormData();\n        // å¤šæ–‡ä»¶éå†ç”Ÿæˆ formData å¯¹è±¡\n        for (let i = 0, len = fileList.length; i < len; i++) {\n            formData.append('file1', fileList[i]);\n        }\n\n        const xhr = new XMLHttpRequest();\n        xhr.open('POST', 'http://localhost:8100', true);\n        // å‘é€æ—¶ï¼ŒContent-Type é»˜è®¤æ˜¯ multipart/form-data\n        xhr.send(formData);\n        xhr.onreadystatechange = function () {\n            console.log('state change', xhr.readyState);\n            if (this.readyState === 4 && this.status === 200) {\n                // è¿”å›å€¼\n                const obj = JSON.parse(xhr.responseText);\n\n                console.log(obj);\n\n                if (obj.fileUrl.length) {\n                    alert('ä¸Šä¼ æˆåŠŸ');\n                }\n            }\n        }\n    });\n</script>\n</body>\n</html>\n```\n\n### è§£å†³è·¨åŸŸ\n\nåœ¨å‰é¢åŸºç¡€æ¥å£éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨ form è¡¨å•è¿›è¡Œä¸Šä¼ ï¼Œä¸ä¼šå­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œä½†åœ¨ xhr ç»“åˆ FormData ä¸Šä¼ çš„æ—¶å€™ï¼Œç›´æ¥è°ƒç”¨åç«¯å°±ä¼šå­˜åœ¨è·¨åŸŸé—®é¢˜ã€‚\n\nåŸå› æ˜¯ form è¡¨å•æäº¤åˆ°å¦ä¸€ä¸ªåŸŸåä¹‹åï¼ŒåŸæ¥é¡µé¢çš„è„šæœ¬æ˜¯è·å–ä¸åˆ°æ–°é¡µé¢ä¸­çš„å†…å®¹çš„ï¼Œæ‰€ä»¥æµè§ˆå™¨è®¤ä¸ºè¿™æ˜¯å®‰å…¨çš„ã€‚\n\nä½† xhr ç»“åˆ FormData ä¸Šä¼ çš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥è¯»å–å“åº”å†…å®¹çš„ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¸ºäº†ä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œè®¾ç½®äº†è·¨åŸŸã€‚\n\nå‚è€ƒï¼š[ä¸ºä»€ä¹ˆformè¡¨å•æäº¤æ²¡æœ‰è·¨åŸŸé—®é¢˜ï¼Œä½†ajaxæäº¤æœ‰è·¨åŸŸé—®é¢˜ï¼Ÿ- çŸ¥ä¹](https://www.zhihu.com/question/31592553)\n\n#### ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ\n\nè·¨åŸŸå®é™…ä¸Šæ˜¯**æµè§ˆå™¨åŒæºç­–ç•¥é™åˆ¶**çš„ä¸€ç±»è¯·æ±‚åœºæ™¯ã€‚\n\n**åŒæºç­–ç•¥ï¼ˆSOPï¼šsame origin policyï¼‰**ï¼šæ˜¯ä¸€ç§çº¦å®šï¼Œæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒçš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœç¼ºå°‘äº†åŒæºç­–ç•¥ï¼Œæµè§ˆå™¨å¾ˆå®¹æ˜“å—åˆ° **XSS**ã€**CSFR**ç­‰æ”»å‡»ã€‚**åŒæº**æ˜¯æŒ‡åè®®ã€åŸŸåã€ç«¯å£ä¸‰è€…ç›¸åŒã€‚\n\n#### koa è§£å†³è·¨åŸŸ\n\nå®‰è£… koa-corsï¼š\n\n```bash\nnpm i -S koa-cors\n```\n\næ·»åŠ ä»£ç ï¼š\n\n```js\nconst cors = require('koa-cors');\n\napp.use(cors());\n```\n\n#### nodejs åŸç”Ÿè§£å†³è·¨åŸŸ\n\nå‰ç«¯å‘é€è¯·æ±‚æ—¶é…ç½®ï¼š\n\n```js\n// å‰ç«¯è®¾ç½®æ˜¯å¦å…è®¸å¸¦ cookie\nxhr.withCredentials = true;\n```\n\nåç«¯è¿™æ˜¯ response å‚æ•°ï¼š\n\n```js\nres.writeHead(200, {\n\t\t// åç«¯å…è®¸å‘é€Cookie\n    'Access-Control-Allow-Credentials': 'true',\n    // å…è®¸è®¿é—®çš„åŸŸï¼ˆåè®®+åŸŸå+ç«¯å£ï¼‰\n    'Access-Control-Allow-Origin': 'xxx',    \n});\n```\n\nè¿™é‡Œä½¿ç”¨çš„è§£å†³è·¨åŸŸçš„æ–¹æ³•éƒ½å±äº **CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰**ï¼Œæ›´å¤šçš„è§£å†³åŠæ³•å‚è€ƒï¼š[å‰ç«¯å¸¸è§è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ˆå…¨ï¼‰](https://juejin.im/entry/59b8fb276fb9a00a42474a6f)ã€‚\n\n### ä¸Šä¼ å›¾ç‰‡é¢„è§ˆ\n\nHTML ä¸­æ·»åŠ ä¸€ä¸ªå­˜æ”¾é¢„è§ˆå›¾ç‰‡çš„ divï¼š\n\n```\n<div class=\"preview-container\" id=\"preview\"></div>\n```\n\nJS ä¸­æ·»åŠ é¢„è§ˆé€»è¾‘ï¼š\n\n```js\ndocument.getElementById('file1').addEventListener('change', function (e) {\n  \tconst files = e.target.files;\n  \tconst previewContainer = document.getElementById('preview');\n\n  \tfor (let i = 0, len = files.length; i < len; i++) {\n    \tlet file = files[i];\n    \tlet img = document.createElement('img');\n    \timg.src = window.URL.createObjectURL(file);\n    \timg.className = 'preview-item';\n\n    \tpreviewContainer.appendChild(img);\n  }\n});\n```\n\n> **URL.createObjectURL()** é™æ€æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ª [`DOMString`](https://developer.mozilla.org/zh-CN/docs/Web/API/DOMString)ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªè¡¨ç¤ºå‚æ•°ä¸­ç»™å‡ºçš„å¯¹è±¡çš„URLã€‚è¿™ä¸ª URL çš„ç”Ÿå‘½å‘¨æœŸå’Œåˆ›å»ºå®ƒçš„çª—å£ä¸­çš„ [`document`](https://developer.mozilla.org/zh-CN/docs/Web/API/Document) ç»‘å®šã€‚è¿™ä¸ªæ–°çš„URL å¯¹è±¡è¡¨ç¤ºæŒ‡å®šçš„ [`File`](https://developer.mozilla.org/zh-CN/docs/Web/API/File) å¯¹è±¡æˆ– [`Blob`](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob) å¯¹è±¡ã€‚\n\n### ä¸Šä¼ è¿›åº¦\n\n- å€ŸåŠ© **XMLHttpRequest** çš„ **onprogress** api å¯ä»¥å®ç°é¢„è§ˆå›¾ç‰‡ä¸Šä¼ è¿›åº¦çš„åŠŸèƒ½\n\n- å€ŸåŠ©ä¸Šä¼ äº‹ä»¶çš„ event å¯¹è±¡çš„ **event.loaded** å’Œ **event.total** è®¡ç®—æ–‡ä»¶ä¸Šä¼ çš„ç™¾åˆ†æ¯”\n- å¤šæ–‡ä»¶ä¸Šä¼ å¦‚æœéœ€è¦è®¡ç®—ä¸Šä¼ è¿›åº¦éœ€è¦ä¾æ¬¡åˆ†åˆ«åˆ›å»º xhr å¯¹è±¡å¹¶å‘é€è¯·æ±‚\n\nå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n\n```html\n<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Document</title>\n    <style>\n        .preview-container .preview-item img {\n            width: 200px;\n        }\n        .red {\n            background: red;\n        }\n        .green {\n            background: green;\n        }\n        .progress {\n            height: 20px;\n        }\n    </style>\n</head>\n<body>\n<input type=\"file\" id=\"file1\" multiple />\n<button type=\"submit\" id=\"submit\">ä¸Š ä¼ </button>\n<div class=\"preview-container\" id=\"preview\"></div>\n<script>\n    let willUploadFiles = [];\n    document.getElementById('file1').addEventListener('change', function (e) {\n        const files = e.target.files;\n        const previewContainer = document.getElementById('preview');\n\n\t\t\t\t// éå†ä¾æ¬¡åˆ›å»ºé¢„è§ˆå’Œè¿›åº¦çš„ DOM\n        for (let i = 0, len = files.length; i < len; i++) {\n            let file = files[i];\n            let wrapper = document.createElement('div');\n            wrapper.className = 'preview-item';\n            let img = document.createElement('img');\n            img.src = window.URL.createObjectURL(file);\n            let  progress = document.createElement('div');\n            progress.className = 'progress';\n            progress.innerHTML = '<span class=\"red\"></span><button type=\"button\">Abort</button>';\n\n            wrapper.appendChild(img);\n            wrapper.appendChild(progress);\n            previewContainer.appendChild(wrapper);\n\n\t\t\t\t\t\t// æŠŠä¸Šä¼ çš„æ–‡ä»¶ç›¸å…³çš„ä¿¡æ¯æš‚å­˜ï¼Œåç»­ä¸Šä¼ è¿›åº¦ä¿®æ”¹æ—¶ä½¿ç”¨\n            willUploadFiles.push({file, wrapper, progress});\n        }\n    });\n    document.getElementById('submit').addEventListener('click', function () {\n        // è·å–æ–‡ä»¶åˆ—è¡¨ï¼Œæ³¨æ„è¿™é‡Œä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯å¯¹è±¡\n        const fileList = document.getElementById('file1').files;\n        if (!fileList.length) {\n            alert('è¯·é€‰æ‹©æ–‡ä»¶');\n            return;\n        }\n        willUploadFiles.forEach(item => {\n            xhrSend(item.file, item.progress);\n        });\n    });\n\n    function xhrSend(file, progress) {\n        let progressSpan = progress.firstElementChild;\n        progressSpan.style.width = '0';\n        progressSpan.classList.remove('green');\n\n        let formData = new FormData();\n        formData.append('file1', file);\n\n        const xhr = new XMLHttpRequest();\n        xhr.open('POST', 'http://localhost:8100', true);\n\n        xhr.onreadystatechange = function () {\n            console.log('state change', xhr.readyState);\n            if (this.readyState === 4 && this.status === 200) {\n                // è¿”å›å€¼\n                const obj = JSON.parse(xhr.responseText);\n                console.log(obj);\n            }\n        };\n\n        xhr.onprogress = updateProgress;\n        xhr.upload.onprogress = updateProgress;\n\n        function updateProgress (event) {\n            // ProgressEvent.lengthComputable æ ‡ç¤º ProgressEvent æ‰€å…³è”çš„èµ„æºæ˜¯å¦å…·æœ‰å¯ä»¥è®¡ç®—çš„é•¿åº¦\n            if (event.lengthComputable) {\n                // è®¡ç®—ä¸Šä¼ ç™¾åˆ†æ¯”\n                let completedPercent = (event.loaded / event.total * 100).toFixed(2);\n                progressSpan.style.width = `${completedPercent}%`;\n                progressSpan.innerHTML = `${completedPercent}%`;\n\n                // è¿›åº¦æ¡å˜è‰²\n                if (completedPercent > 90) {\n                    progressSpan.classList.add('green');\n                } else if(completedPercent >= 100){\n                    xhr.uploaded = true;\n                }\n                console.log('å·²ä¸Šä¼ ',completedPercent);\n            }\n        }\n\n        // å‘é€æ—¶ï¼ŒContent-Type é»˜è®¤æ˜¯ multipart/form-data\n        xhr.send(formData);\n\n        let abortBtn = progress.getElementsByTagName('button')[0];\n        abortBtn.addEventListener('click', function (e) {\n            if (xhr && xhr.readyState !== 4) {\n                // å–æ¶ˆä¸Šä¼ \n                xhr.abort();\n            }\n        });\n    }\n</script>\n</body>\n</html>\n```\n\n### æ‹–æ‹½ä¸Šä¼ \n\nåŸºäº HTML5 **æ‹–æ‹½**æ–°ç‰¹æ€§ï¼Œå¯ä»¥å®ç°æ‹–æ‹½è¿›å…¥åŒºåŸŸï¼Œä¸Šä¼ æ–‡ä»¶çš„åŠŸèƒ½ã€‚\n\n- ç¦ç”¨æµè§ˆå™¨çš„é»˜è®¤æ‹–æ”¾è¡Œä¸º\n- ç›‘å¬ **drop** äº‹ä»¶\n- **drop** äº‹ä»¶ä¸­ï¼Œé€šè¿‡ **e.dataTransfer.files** è·å–æ‹–æ‹½ä¸­çš„æ–‡ä»¶å¯¹è±¡\n- ä½¿ç”¨ **FormData** å’Œ **xhr** ç»“åˆä¸Šä¼ æ–‡ä»¶\n\nå…·ä½“çš„ä»£ç å°±ä¸è´´äº†ã€‚\n\n> å•Šï¼Œå†™å®Œäº†ï¼Œæˆ‘è¦åšæŒï¼ğŸ¤¯");

/***/ })

}]);
//# sourceMappingURL=publisher-JS-md.js.map